<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Demonstration workflows with rsofun • rsofundemo</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,300;0,400;0,700;1,300;1,400&amp;display=swap" rel="stylesheet">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><!-- geco --><link href="geco.css" rel="stylesheet">
<meta property="og:title" content="Demonstration workflows with rsofun">
<meta property="og:description" content="Contains demonstration workflows for using {rsofun} for common applications as vignettes. This is provided here in a separate package and repository to keep code and dependencies in {rsofun} slim.">
<meta name="twitter:card" content="summary">
<!-- Mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js" async integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/config/TeX-AMS-MML_HTMLorMML.js" async integrity="sha256-4zys9A4hMQmtq2EUL+JRoXc0NZi8jVJMzb8onewOaSQ=" crossorigin="anonymous"></script>
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">

    <div class="navbar-header">

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="external-link hidden-sm hidden-xs" href="https://geco-group.org/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_white_small.png" id="hexlogo" alt="GECO"></a>
        <a class="external-link hidden-md hidden-lg" href="https://geco-group.org/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_white_small.png" id="hexlogo" alt="GECO"></a>
        <a class="navbar-brand" href="index.html">
           <i>rsofundemo <small>v0.1</small></i>
        </a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/cnmodel_fluxnet.html">C-only and CN-model at a FLUXNET site</a>
    </li>
    <li>
      <a href="articles/pmodel_fluxnet.html">P-model at FLUXNET sites</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/stineb/rsofundemo/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="demonstration-workflows-with-rsofun">Demonstration workflows with rsofun<a class="anchor" aria-label="anchor" href="#demonstration-workflows-with-rsofun"></a>
</h1></div>
<p>Contains demonstration workflows for using {rsofun} for common applications. This is provided here in a separate package and repository to keep code and dependencies in {rsofun} slim.</p>
<p>All demonstration workflows are implemented as vignettes in <code>./vignettes/</code> and displayed under ‘Articles’ on the <a href="https://geco-bern.github.io/rsofun/articles/" class="external-link">website</a>.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="section level3">
<h3 id="stable-release">Stable release<a class="anchor" aria-label="anchor" href="#stable-release"></a>
</h3>
<p>rsofun is currently available on CRAN and the latest release can be installed with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"rsofun"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/geco-bern/rsofun" class="external-link">"rsofun"</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="development-release-and-older-releases">Development release and older releases<a class="anchor" aria-label="anchor" href="#development-release-and-older-releases"></a>
</h3>
<p>To install the development version or any <a href="https://github.com/geco-bern/rsofun/releases" class="external-link">older released version</a> of the package from GitHub run one of the following commands:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"geco-bern/rsofun"</span><span class="op">)</span> <span class="co"># for the latest development release</span></span>
<span><span class="co"># remotes::install_github("geco-bern/rsofun", ref = "v5.1.0") # will always be v5.1.0</span></span>
<span><span class="co"># remotes::install_github("geco-bern/rsofun", ref = "v4.4") # will always be v4.4</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/geco-bern/rsofun" class="external-link">"rsofun"</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="install-manually">Install manually<a class="anchor" aria-label="anchor" href="#install-manually"></a>
</h3>
<p>If none of the previously mention installation works, download the tar.gz folder from <a href="https://github.com/geco-bern/rsofun/releases" class="external-link">here</a> and use the command</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">path_to_file</span>, repos <span class="op">=</span> <span class="cn">NULL</span>, type<span class="op">=</span><span class="st">"source"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/geco-bern/rsofun" class="external-link">"rsofun"</a></span><span class="op">)</span></span></code></pre></div>
<p><strong>NOTE:</strong> Installing from GitHub requires compilation of Fortran and C source code contained in {rsofun}. To enable compiling source code, install <a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link">Rtools</a> on Windows, or <a href="https://developer.apple.com/xcode/" class="external-link">Xcode</a> and the <a href="https://github.com/fxcoudert/gfortran-for-macOS" class="external-link">GNU Fortran compiler on Mac</a> (see also ‘Mandatory tools’ <a href="https://mac.r-project.org/tools/" class="external-link">here</a>). On Linux, the gfortran compiler is usually installed already.</p>
<p>Vignettes are not rendered by default, if you want to include additional documentation please use:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"geco-bern/rsofun"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/geco-bern/rsofun" class="external-link">"rsofun"</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="analysis-usage">Analysis usage<a class="anchor" aria-label="anchor" href="#analysis-usage"></a>
</h2>
<p>The <a href="https://github.com/stineb/rsofundemo/tree/main/analysis" class="external-link">00_validation_files_creation.R</a> file creates the validation data necessary to run the P-model. The driver data can be obatined from <a href="https://github.com/geco-bern/FluxDataKit/tree/main/data" class="external-link">FluxDatakit</a>. the files will be stoted in <a href="https://github.com/stineb/rsofundemo/tree/main/data" class="external-link">data</a>.</p>
<p>The file will use two custom function that can be found in <a href="https://github.com/stineb/rsofundemo/tree/main/R" class="external-link">R</a>. To work it requires the path for each file needed and an output path to store the results.</p>
<p>to run the script, you need to use the repository <a href="https://github.com/geco-bern/FluxDataKit/tree/main" class="external-link">FLuxDataKit</a> to create the files that are needed. The metadata file is already present in <a href="https://github.com/stineb/rsofundemo/tree/main/data-raw" class="external-link">data-raw</a>.</p>
</div>
<div class="section level2">
<h2 id="p-model-use">P-model Use<a class="anchor" aria-label="anchor" href="#p-model-use"></a>
</h2>
<p>Below sections show the ease of use of the package in terms of model parameter specification and running both a single run or optimizing the parameters for a given site. For an in depth discussion we refer to the <a href="https://geco-bern.github.io/rsofun/articles/" class="external-link">vignettes</a>.</p>
<div class="section level3">
<h3 id="running-model">Running model<a class="anchor" aria-label="anchor" href="#running-model"></a>
</h3>
<p>With all data prepared we can run the P-model using <code>runread_pmodel_f()</code>. This function takes the nested data structure and runs the model for each site separately, returning nested model output results matching the input drivers. The data structure needs to have a specific structure explained in <code>p_model_drivers</code> documentation. You can use either the <code>p_model_drivers</code> and <code>p_model_validation</code> or use the driver data downloaded previously. The validation data can be obtained from <a href="https://github.com/stineb/rsofundemo/tree/main/analysis" class="external-link">00_validation_files_creation.R</a>. The last two data can be loaded using <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS()</a></code>. Depending on the exact version of <code>rsofun</code> these examples files might be called <code>pmodel_drivers</code> and <code>pmodel_validation</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="running-model-1">Running model<a class="anchor" aria-label="anchor" href="#running-model-1"></a>
</h2>
<p>To run the model, is necessary to define the parameters that will be using during the analysis. The optimal parameters are already present in the vignette. With all data prepared we can run the P-model using <code>runread_pmodel_f()</code>. This function takes the nested data structure and runs the model site by site, returning nested model output results matching the input drivers. To have an in-depth description of the model output refers to <code>run_pmodel_f_bysite ()</code> documentation.</p>
</div>
<div class="section level2">
<h2 id="plotting-creation">Plotting creation<a class="anchor" aria-label="anchor" href="#plotting-creation"></a>
</h2>
<p>To show the result, a data frame containing all the sites is created. The plot will be stored as png file which can be found in <a href="https://github.com/stineb/rsofundemo/tree/main/fig" class="external-link">fig</a>.</p>
</div>
<div class="section level2">
<h2 id="calibrating-model-parameters">Calibrating model parameters<a class="anchor" aria-label="anchor" href="#calibrating-model-parameters"></a>
</h2>
<p>To optimize new parameters based upon driver data and a validation dataset we must first specify an optimization strategy and settings, as well as a cost function and parameter ranges.</p>
<p><code>rsofun</code> supports both optimization using the <code>GenSA</code> and <code>BayesianTools</code> packages. The above statement provides settings for a <code>GenSA</code> optimization approach. For this example the maximum number of iterations is kept artificially low. In a real scenario you will have to increase this value orders of magnitude. Keep in mind that optimization routines rely on a cost function, which, depending on its structure influences parameter selection. A limited set of cost functions is provided but the model structure is transparent and custom cost functions can be easily written. More details can be found in the “Parameter calibration and cost functions” vignette.</p>
<p>In addition starting values and ranges are provided for the free parameters in the model. Free parameters include: parameters for the quantum yield efficiency <code>kphio</code>, <code>kphio_par_a</code> and <code>kphio_par_b</code>, soil moisture stress parameters <code>soilm_thetastar</code> and <code>soilm_betao</code>, and also <code>beta_unitcostratio</code>, <code>rd_to_vcmax</code>, <code>tau_acclim</code> and <code>kc_jmax</code> (see <code>?runread_pmodel_f</code>). Be mindful that with newer versions of <code>rsofun</code> additional parameters might be introduced, so re-check vignettes and function documentation when updating existing code.</p>
<p>With all settings defined the optimization function <code>calib_sofun()</code> can be called with driver data and observations specified. Extra arguments for the cost function (like what variable should be used as target to compute the root mean squared error (RMSE) and previous values for the parameters that aren’t calibrated, which are needed to run the P-model).</p>
<p>The updated model will yield better result. The model will run in the same way as the non calibrated p model.</p>
</div>
<div class="section level2">
<h2 id="updating-the-plot-dataframe">Updating the plot dataframe<a class="anchor" aria-label="anchor" href="#updating-the-plot-dataframe"></a>
</h2>
<p>After the calibration is possible to update the plot dataframe by adding the parameterized output and the plot will be stored as png file.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Stocker, B. D., Wang, H., Smith, N. G., Harrison, S. P., Keenan, T. F., Sandoval, D., Davis, T., and Prentice, I. C.: P-model v1.0: an optimality-based light use efficiency model for simulating ecosystem gross primary production, Geosci. Model Dev., 13, 1545–1581, <a href="https://doi.org/10.5194/gmd-13-1545-2020" class="external-link uri">https://doi.org/10.5194/gmd-13-1545-2020</a>, 2020.</p>
<p>For details on the optimization settings we refer to the manuals of <a href="https://cran.r-project.org/package=GenSA" class="external-link">GenSA</a> and <a href="https://github.com/florianhartig/BayesianTools" class="external-link">BayesianTools</a>.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/stineb/rsofundemo/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/stineb/rsofundemo/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/AGPL-3" class="external-link">AGPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing rsofundemo</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Benjamin Stocker <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-2697-9096" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a>  </li>
</ul>
</div>



  </div>
</div>


      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/geco-bern" target="_blank" class="external-link">
                          <div class="icon fab fa-github"></div></a>
                        <a href="https://geco-group.org" target="_blank" class="external-link">
                          <div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/SteniBocker/" target="_blank" class="external-link">
                          <div class="icon fab fa-twitter"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://geco-group.org/" class="external-link">GECO</a></li>
                            <li><a href="https://geco-group.org/people/" class="external-link">Our Team</a></li>
                            <li><a href="https://geco-group.org/contact/" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://github.com/geco-bern" class="external-link">Packages</a></li>
                            <li><a href="https://geco-group.org/publication/" class="external-link">Publications</a></li>
                            <li><a href="https://geco-group.org/post/" class="external-link">Blog</a></li>
                        </ul>
</div>

                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
</div>






  </body>
</html>
