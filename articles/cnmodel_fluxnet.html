<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C-only and CN-model at a FLUXNET site â€¢ rsofundemo</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- Fonts --><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Titillium+Web:ital,wght@0,300;0,400;0,700;1,300;1,400&amp;display=swap" rel="stylesheet">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- geco --><link href="../geco.css" rel="stylesheet">
<meta property="og:title" content="C-only and CN-model at a FLUXNET site">
<meta property="og:description" content="rsofundemo">
<meta name="twitter:card" content="summary">
<!-- Mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js" async integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/config/TeX-AMS-MML_HTMLorMML.js" async integrity="sha256-4zys9A4hMQmtq2EUL+JRoXc0NZi8jVJMzb8onewOaSQ=" crossorigin="anonymous"></script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">

    <div class="navbar-header">

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="external-link hidden-sm hidden-xs" href="https://geco-group.org/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_white_small.png" id="hexlogo" alt="GECO"></a>
        <a class="external-link hidden-md hidden-lg" href="https://geco-group.org/">
          <img src="https://raw.githubusercontent.com/computationales/GECO_template/main/geco_logo_white_small.png" id="hexlogo" alt="GECO"></a>
        <a class="navbar-brand" href="../index.html">
           <i>rsofundemo <small>v0.1</small></i>
        </a>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/cnmodel_fluxnet.html">C-only and CN-model at a FLUXNET site</a>
    </li>
    <li>
      <a href="../articles/pmodel_fluxnet.html">P-model at FLUXNET sites</a>
    </li>
  </ul>
</li>
        <li>
  <a href="https://github.com/stineb/rsofundemo/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>C-only and CN-model at a FLUXNET site</h1>
                        <h4 data-toc-skip class="author">Beni
Stocker</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/stineb/rsofundemo/blob/HEAD/vignettes/cnmodel_fluxnet.Rmd" class="external-link"><code>vignettes/cnmodel_fluxnet.Rmd</code></a></small>
      <div class="hidden name"><code>cnmodel_fluxnet.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># some general libraries </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org" class="external-link">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/visdat/" class="external-link">visdat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="aim">Aim<a class="anchor" aria-label="anchor" href="#aim"></a>
</h2>
<p>Demonstrate the use of the CN-model, including its C-only setup, for
simulating ecosystem fluxes, growth, biomass, ecosystem C balance and N
cycling at a single site. Here, we use CH-Oe2 - a managed grassland in
Switzerland.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>{rsofun} is not on CRAN. The development version of CN-model lives in
a branch on GitHub of the {rsofun} fork by stineb (Beni Stocker).
Install it from there.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span><span class="op">)</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">remotes</span><span class="op">)</span><span class="op">}</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"stineb/rsofun"</span>, ref <span class="op">=</span> <span class="st">"cnmodel"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">rsofun</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="forcing-data">Forcing data<a class="anchor" aria-label="anchor" href="#forcing-data"></a>
</h2>
<div class="section level3">
<h3 id="climate">Climate<a class="anchor" aria-label="anchor" href="#climate"></a>
</h3>
<p>Climate forcing data can be obtained from the FluxDataKit {rsofun}
driver object. The model driver object is constructed from data
collected and processed (unit conversion, some limited additional
gap-filling) from FLUXNET-standard data, obtained from regional networks
and previous collection efforts (ICOS, AmeriFlux, PLUMBER-2, etc). The
model driver object is made available on Zenodo:</p>
<p><em>Hufkens, K., &amp; Stocker, B. (2024). FluxDataKit v3.1: A
comprehensive data set of ecosystem fluxes for land surface modelling
(3.1) [Data set]. Zenodo. <a href="https://doi.org/10.5281/zenodo.11370417" class="external-link uri">https://doi.org/10.5281/zenodo.11370417</a></em></p>
<p>Download the file <code>rsofun_driver_data_v3.1.rds</code> and place
it locally. It is not included in the repository <em>rsofundemo</em>.
Read it, pointing to its local path, and subset to the desired site.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">driver</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"~/data/FluxDataKit/v3.2/rsofun_driver_data_v3.2.rds"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sitename</span> <span class="op">==</span> <span class="st">"CH-Oe1"</span><span class="op">)</span></span></code></pre></div>
<p>Check for missing values in the forcing data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">driver</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">sitename</span>, <span class="va">forcing</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unnest.html" class="external-link">unnest</a></span><span class="op">(</span><span class="va">forcing</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/visdat/reference/vis_miss.html" class="external-link">vis_miss</a></span><span class="op">(</span>warn_large_data <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/missingdata_choe2.png" width="800px"></p>
<p>We see that some variables have missing data. Net radiation being
missing is not a problem as it is currently internally estimated and not
taken from the forcing.</p>
</div>
<div class="section level3">
<h3 id="nitrogen-deposition">Nitrogen deposition<a class="anchor" aria-label="anchor" href="#nitrogen-deposition"></a>
</h3>
<p>Reactive N inputs from atmospheric deposition and/or mineral N
fertiliser applications needs to be prescribed in gN added per day. This
information is added to the forcing time series. That means, we need to
specify how much N is added on which day. For atmospheric N deposition,
monthly or annual totals may be either evenly distributed among days in
a year or added in proportion to precipitation.</p>
<p>In this example, we simply add a constant rate on each day. The value
used here is obtained as the annual total for respective years from
Lamarque et al., divided by 365.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">driver</span> <span class="op">&lt;-</span> <span class="va">driver</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>forcing <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>    <span class="va">forcing</span>, </span>
<span>    <span class="op">~</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      <span class="va">.</span>,</span>
<span>      fharv <span class="op">=</span> <span class="fl">0.0</span>,</span>
<span>      dno3 <span class="op">=</span> <span class="fl">0.002003263</span>,</span>
<span>      dnh4 <span class="op">=</span> <span class="fl">0.002017981</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="harvesting">Harvesting<a class="anchor" aria-label="anchor" href="#harvesting"></a>
</h3>
<p>When applying the CN-model for simulating C and N dynamics in a
grassland, the harvesting of biomass (and its export off-site) needs to
be accounted for. The fraction of aboveground biomass harvested per day
needs to be specified in the forcing time series. Letâ€™s assume that
nothing is harvested (<code>fharv = 0</code>).</p>
<p>Also N (and C) additions in the form of new seeds added to the field
after harvesting are accounted for (<code>cseed</code> and
<code>nseed</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">use_cseed</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">cn_seed</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">use_nseed</span> <span class="op">&lt;-</span> <span class="va">use_cseed</span> <span class="op">/</span> <span class="va">cn_seed</span></span>
<span></span>
<span><span class="va">driver</span> <span class="op">&lt;-</span> <span class="va">driver</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    forcing <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>      <span class="va">forcing</span>, <span class="op">~</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>        <span class="va">.</span>,</span>
<span>        fharv <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">==</span> <span class="fl">7</span> <span class="op">&amp;</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">mday</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">==</span> <span class="fl">15</span>, <span class="fl">0.0</span>, <span class="fl">0.0</span><span class="op">)</span>,</span>
<span>        cseed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">mday</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">==</span> <span class="fl">15</span>, <span class="va">use_cseed</span>, <span class="fl">0.0</span><span class="op">)</span>,</span>
<span>        nseed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">&amp;</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">mday</a></span><span class="op">(</span><span class="va">date</span><span class="op">)</span> <span class="op">==</span> <span class="fl">15</span>, <span class="va">use_nseed</span>, <span class="fl">0.0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="simulation-parameters">Simulation parameters<a class="anchor" aria-label="anchor" href="#simulation-parameters"></a>
</h2>
<p>The spinup of the CN-model must be long enough to equilibrate fluxes.
The model spin-up procedure is explained in Stocker &amp; Prentice
(2024) <em>biorxiv</em>. It is set to 2002 years here. During the
spinup, the first five years of the model forcing time series are
recycled such that an entire recycling period is terminated at the end
of the last spin-up year. This temporal alignment is treated
automatically by the CN-model.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">driver</span><span class="op">$</span><span class="va">params_siml</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">spinupyears</span> <span class="op">&lt;-</span> <span class="fl">2002</span></span>
<span><span class="va">driver</span><span class="op">$</span><span class="va">params_siml</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">recycle</span> <span class="op">&lt;-</span> <span class="fl">5</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-parameters">Model parameters<a class="anchor" aria-label="anchor" href="#model-parameters"></a>
</h2>
<p>The list of model parameters for the CN-model is long and (almost
all) explained in Stocker &amp; Prentice (2024) <em>biorxiv</em>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span></span>
<span>  <span class="co"># P-model</span></span>
<span>  kphio                 <span class="op">=</span> <span class="fl">0.04998</span>,    <span class="co"># setup ORG in Stocker et al. 2020 GMD</span></span>
<span>  kphio_par_a           <span class="op">=</span> <span class="fl">0.0</span>,        <span class="co"># set to zero to disable temperature-dependence of kphio</span></span>
<span>  kphio_par_b           <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>  soilm_thetastar       <span class="op">=</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="fl">240</span>,  <span class="co"># to recover old setup with soil moisture stress</span></span>
<span>  soilm_betao           <span class="op">=</span> <span class="fl">0.0</span>,</span>
<span>  beta_unitcostratio    <span class="op">=</span> <span class="fl">146.0</span>,</span>
<span>  rd_to_vcmax           <span class="op">=</span> <span class="fl">0.014</span>,      <span class="co"># value from Atkin et al. 2015 for C3 herbaceous</span></span>
<span>  tau_acclim            <span class="op">=</span> <span class="fl">30.0</span>,</span>
<span>  kc_jmax               <span class="op">=</span> <span class="fl">0.41</span>,</span>
<span></span>
<span>  <span class="co"># Plant</span></span>
<span>  f_nretain             <span class="op">=</span> <span class="fl">0.500000</span>,</span>
<span>  fpc_tree_max          <span class="op">=</span> <span class="fl">0.950000</span>,</span>
<span>  growtheff             <span class="op">=</span> <span class="fl">0.600000</span>,</span>
<span>  r_root                <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="fl">0.913000</span>,</span>
<span>  r_sapw                <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="fl">0.044000</span>,</span>
<span>  exurate               <span class="op">=</span> <span class="fl">0.003000</span>,</span>
<span></span>
<span>  k_decay_leaf          <span class="op">=</span> <span class="fl">1.90000</span>,</span>
<span>  k_decay_root          <span class="op">=</span> <span class="fl">1.90000</span>,</span>
<span>  k_decay_labl          <span class="op">=</span> <span class="fl">1.90000</span>,</span>
<span>  k_decay_sapw          <span class="op">=</span> <span class="fl">1.90000</span>,</span>
<span></span>
<span>  r_cton_root           <span class="op">=</span> <span class="fl">37.0000</span>,</span>
<span>  r_cton_wood           <span class="op">=</span> <span class="fl">100.000</span>,</span>
<span>  r_cton_seed           <span class="op">=</span> <span class="fl">15.0000</span>,</span>
<span>  nv_vcmax25            <span class="op">=</span> <span class="fl">0.02</span> <span class="op">*</span> <span class="fl">13681.77</span>, <span class="co"># see ln_cn_review/vignettes/analysis_leafn_vcmax_field.Rmd, l.695; previously: 5000.0,</span></span>
<span>  ncw_min               <span class="op">=</span> <span class="fl">0.08</span> <span class="op">*</span> <span class="fl">1.116222</span>, <span class="co"># see ln_cn_review/vignettes/analysis_leafn_vcmax_field.Rmd, l.691; previously used: 0.056,</span></span>
<span>  r_n_cw_v              <span class="op">=</span> <span class="fl">0</span>, <span class="co"># assumed that LMA is independent of Vcmax25; previously: 0.1,</span></span>
<span>  r_ctostructn_leaf     <span class="op">=</span> <span class="fl">1.3</span> <span class="op">*</span> <span class="fl">45.84125</span>, <span class="co"># see ln_cn_review/vignettes/analysis_leafn_vcmax_field.Rmd, l.699; previously used: 80.0000,</span></span>
<span>  kbeer                 <span class="op">=</span> <span class="fl">0.500000</span>,</span>
<span></span>
<span>  <span class="co"># Phenology (should be PFT-specific)</span></span>
<span>  gddbase               <span class="op">=</span> <span class="fl">5.0</span>,</span>
<span>  ramp                  <span class="op">=</span> <span class="fl">0.0</span>,</span>
<span>  phentype              <span class="op">=</span> <span class="fl">2.0</span>,</span>
<span></span>
<span>  <span class="co"># Soil physics (should be derived from params_soil, fsand, fclay, forg, fgravel)</span></span>
<span>  perc_k1               <span class="op">=</span> <span class="fl">5.0</span>,</span>
<span>  thdiff_wp             <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  thdiff_whc15          <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  thdiff_fc             <span class="op">=</span> <span class="fl">0.4</span>,</span>
<span>  forg                  <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  wbwp                  <span class="op">=</span> <span class="fl">0.029</span>,</span>
<span>  por                   <span class="op">=</span> <span class="fl">0.421</span>,</span>
<span>  fsand                 <span class="op">=</span> <span class="fl">0.82</span>,</span>
<span>  fclay                 <span class="op">=</span> <span class="fl">0.06</span>,</span>
<span>  fsilt                 <span class="op">=</span> <span class="fl">0.12</span>,</span>
<span></span>
<span>  <span class="co"># Water and energy balance</span></span>
<span>  kA                    <span class="op">=</span> <span class="fl">107</span>,</span>
<span>  kalb_sw               <span class="op">=</span> <span class="fl">0.17</span>,</span>
<span>  kalb_vis              <span class="op">=</span> <span class="fl">0.03</span>,</span>
<span>  kb                    <span class="op">=</span> <span class="fl">0.20</span>,</span>
<span>  kc                    <span class="op">=</span> <span class="fl">0.25</span>,</span>
<span>  kCw                   <span class="op">=</span> <span class="fl">1.05</span>,</span>
<span>  kd                    <span class="op">=</span> <span class="fl">0.50</span>,</span>
<span>  ke                    <span class="op">=</span> <span class="fl">0.0167</span>,</span>
<span>  keps                  <span class="op">=</span> <span class="fl">23.44</span>,</span>
<span>  kWm                   <span class="op">=</span> <span class="fl">220.0</span>,</span>
<span>  kw                    <span class="op">=</span> <span class="fl">0.26</span>,</span>
<span>  komega                <span class="op">=</span> <span class="fl">283.0</span>,</span>
<span>  maxmeltrate           <span class="op">=</span> <span class="fl">3.0</span>,</span>
<span></span>
<span>  <span class="co"># Soil BGC</span></span>
<span>  klitt_af10            <span class="op">=</span> <span class="fl">1.2</span>,</span>
<span>  klitt_as10            <span class="op">=</span> <span class="fl">0.35</span>,</span>
<span>  klitt_bg10            <span class="op">=</span> <span class="fl">0.35</span>,</span>
<span>  kexu10                <span class="op">=</span> <span class="fl">50.0</span>,</span>
<span>  ksoil_fs10            <span class="op">=</span> <span class="fl">0.021</span>,</span>
<span>  ksoil_sl10            <span class="op">=</span> <span class="fl">7.0e-04</span>,</span>
<span>  ntoc_crit1            <span class="op">=</span> <span class="fl">0.45</span>,</span>
<span>  ntoc_crit2            <span class="op">=</span> <span class="fl">0.76</span>,</span>
<span>  cton_microb           <span class="op">=</span> <span class="fl">10.0</span>,</span>
<span>  cton_soil             <span class="op">=</span> <span class="fl">9.77</span>,</span>
<span>  fastfrac              <span class="op">=</span> <span class="fl">0.985</span>,</span>
<span></span>
<span>  <span class="co"># N uptake</span></span>
<span>  eff_nup               <span class="op">=</span> <span class="fl">0.0001000</span>,</span>
<span>  minimumcostfix        <span class="op">=</span> <span class="fl">1.000000</span>,</span>
<span>  fixoptimum            <span class="op">=</span> <span class="fl">25.15000</span>,</span>
<span>  a_param_fix           <span class="op">=</span> <span class="op">-</span><span class="fl">3.62000</span>,</span>
<span>  b_param_fix           <span class="op">=</span> <span class="fl">0.270000</span>,</span>
<span></span>
<span>  <span class="co"># Inorganic N transformations (re-interpreted for simple ntransform model)</span></span>
<span>  maxnitr               <span class="op">=</span>  <span class="fl">0.00005</span>,</span>
<span></span>
<span>  <span class="co"># Inorganic N transformations for full ntransform model (not used in simple model)</span></span>
<span>  non                   <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  n2on                  <span class="op">=</span> <span class="fl">0.0005</span>,</span>
<span>  kn                    <span class="op">=</span> <span class="fl">83.0</span>,</span>
<span>  kdoc                  <span class="op">=</span> <span class="fl">17.0</span>,</span>
<span>  docmax                <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>  dnitr2n2o             <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span></span>
<span>  <span class="co"># Additional parameters - previously forgotten</span></span>
<span>  frac_leaf             <span class="op">=</span> <span class="fl">0.5</span>,         <span class="co"># after wood allocation</span></span>
<span>  frac_wood             <span class="op">=</span> <span class="fl">0</span>,           <span class="co"># highest priority in allocation</span></span>
<span>  frac_avl_labl         <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span></span>
<span>  <span class="co"># for development</span></span>
<span>  tmppar                <span class="op">=</span> <span class="fl">9999</span>,</span>
<span></span>
<span>  <span class="co"># simple N uptake module parameters</span></span>
<span>  nuptake_kc            <span class="op">=</span> <span class="fl">600</span>,</span>
<span>  nuptake_kv            <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  nuptake_vmax          <span class="op">=</span> <span class="fl">0.2</span></span>
<span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-the-model">Run the model<a class="anchor" aria-label="anchor" href="#run-the-model"></a>
</h2>
<p>Before running the model, we need to create an output directory for
soil C.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"mkdir "</span>, <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/out"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"mkdir "</span>, <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"vignettes"</span><span class="op">)</span>, <span class="st">"/out"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="c-only-run">C-only run<a class="anchor" aria-label="anchor" href="#c-only-run"></a>
</h3>
<p>The model can be run in C-only mode. That is, N is still calculated,
but its balance is not considered for affecting allocation. Its balance
is not closed.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define whether to use interactive C-N cycling</span></span>
<span><span class="va">driver</span><span class="op">$</span><span class="va">params_siml</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">c_only</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span></code></pre></div>
<p>With all data prepared we can now run the P-model using the function
<code>runread_cnmodel_f()</code> from the {rsofun} package. This
function takes the nested data structure and runs the model site by
site, returning nested model output results matching the input
drivers.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">runread_cnmodel_f</span><span class="op">(</span></span>
<span>  <span class="va">driver</span>,</span>
<span>  par <span class="op">=</span> <span class="va">pars</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="some-outputs">Some outputs<a class="anchor" aria-label="anchor" href="#some-outputs"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#### LAI -----------------------------</span></span>
<span><span class="va">gg1</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">lai</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"LAI (m"</span><span class="op">^</span><span class="fl">2</span>, <span class="st">" m"</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### GPP -----------------------------</span></span>
<span><span class="va">gg2</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">gpp</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"GPP (gC m"</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span>, <span class="st">" d"</span><span class="op">^</span><span class="op">-</span><span class="fl">1</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### NEP -----------------------------</span></span>
<span><span class="va">gg3</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">gpp</span> <span class="op">-</span> <span class="va">rleaf</span> <span class="op">-</span> <span class="va">rwood</span> <span class="op">-</span> <span class="va">rroot</span> <span class="op">-</span> <span class="va">rhet</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"NEP (gC m"</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span>, <span class="st">" d"</span><span class="op">^</span><span class="op">-</span><span class="fl">1</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#### cumulative NEP -----------------------------</span></span>
<span><span class="co"># by GPP</span></span>
<span><span class="va">gg4</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">$</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">date</span>, <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">gpp</span> <span class="op">-</span> <span class="va">rleaf</span> <span class="op">-</span> <span class="va">rwood</span> <span class="op">-</span> <span class="va">rroot</span> <span class="op">-</span> <span class="va">rhet</span> <span class="op">-</span> <span class="va">rgrow</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># geom_smooth(method = "lm", se = FALSE) +</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Cum. NEP (gC m"</span><span class="op">^</span><span class="op">-</span><span class="fl">2</span>, <span class="st">")"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">gg1</span>,</span>
<span>  <span class="va">gg2</span>,</span>
<span>  <span class="va">gg3</span>,</span>
<span>  <span class="va">gg4</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/outputs_cnmodel_tseries.png" width="800px"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start bottom-8">
            <div class="col-xs-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/geco-bern" target="_blank" class="external-link">
                          <div class="icon fab fa-github"></div></a>
                        <a href="https://geco-group.org" target="_blank" class="external-link">
                          <div class="icon fa fa-flask"></div></a>
                        <a href="http://twitter.com/SteniBocker/" target="_blank" class="external-link">
                          <div class="icon fab fa-twitter"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://geco-group.org/" class="external-link">GECO</a></li>
                            <li><a href="https://geco-group.org/people/" class="external-link">Our Team</a></li>
                            <li><a href="https://geco-group.org/contact/" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://github.com/geco-bern" class="external-link">Packages</a></li>
                            <li><a href="https://geco-group.org/publication/" class="external-link">Publications</a></li>
                            <li><a href="https://geco-group.org/post/" class="external-link">Blog</a></li>
                        </ul>
</div>

                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->

      </footer>
</div>

  


  

  </body>
</html>
